<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="text-primary">ğŸ’³ Payments</h4>
  <div>
    <button class="btn btn-success me-2" (click)="openAdd()">â• Add</button>
    <button class="btn btn-outline-secondary" (click)="loadPayments()" [disabled]="loading">
      ğŸ” Refresh
    </button>
  </div>
</div>

<div *ngIf="error" class="alert alert-danger">{{ error }}</div>

<div class="row mb-3">
  <div class="col-md-4">
    <input class="form-control" placeholder="Filter status (Pending / Partial / Paid)" [(ngModel)]="filterStatus" />
  </div>
  <div class="col-md-8 text-end">
    <small class="text-muted me-3">Collected: <strong>{{ formatAmount(totalCollected) }}</strong></small>
    <small class="text-muted">Pending: <strong>{{ formatAmount(totalPending) }}</strong></small>
  </div>
</div>

<div *ngIf="loading" class="text-center my-5">
  <div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
</div>

<table *ngIf="!loading && filteredPayments.length > 0" class="table table-hover align-middle">
  <thead class="table-light">
    <tr>
      <th>#</th>
      <th>Client</th>
      <th>Phone</th>
      <th>Property</th>
      <th>Collected</th>
      <th>Pending</th>
      <th>Status</th>
      <th>Next Due</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let p of filteredPayments; let i = index">
      <td>{{ i + 1 }}</td>
      <td>{{ p.clientName }}</td>
      <td>
        <a *ngIf="p.clientPhone" [href]="'tel:' + p.clientPhone" class="text-decoration-none text-primary fw-bold">
          {{ p.clientPhone }}
        </a>

        <span *ngIf="!p.clientPhone">â€”</span>
      </td>
      <td>{{ p.propertyName || 'â€”' }}</td>
      <td>{{ formatAmount(p.paidAmount) }}</td>
      <td>{{ formatAmount(p.pendingAmount) }}</td>
      <td>
        <span class="badge" [ngClass]="{
                'bg-warning text-dark': p.status === 'Pending',
                'bg-info text-dark': p.status === 'Partial',
                'bg-success': p.status === 'Paid'
              }">
          {{ p.status }}
        </span>
      </td>
      <td>{{ p.nextDueDate || 'â€”' }}</td>
      <td>
        <button class="btn btn-sm btn-outline-primary me-1" (click)="edit(p)">âœï¸</button>
        <button class="btn btn-sm btn-outline-danger me-1" (click)="delete(p.id)">ğŸ—‘ï¸</button>
        <button class="btn btn-sm btn-outline-success" (click)="sendReminder(p)">ğŸ“©</button>
      </td>
    </tr>
  </tbody>
</table>

<div *ngIf="!loading && filteredPayments.length === 0" class="text-center text-muted my-4">
  No records found.
</div>
<!-- ğŸ”¹ Toast Notification -->
<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1200;">
  <div id="toastMessage" class="toast align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive"
    aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">Message</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
        aria-label="Close"></button>
    </div>
  </div>
</div>