<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="text-primary">ðŸ“… Follow-Up Automation</h4>
  <button class="btn btn-outline-primary" (click)="refreshFollowups()">ðŸ”„ Re-check</button>
</div>

<div class="mb-3 d-flex flex-wrap gap-2">
  <select class="form-select w-auto" [(ngModel)]="selectedModule" (change)="applyFilters()">
    <option value="">All Modules</option>
    <option>PROPERTY_LISTING</option>
    <option>LEAD_MANAGEMENT</option>
    <option>CLIENT_INTERACTION</option>
    <option>CLIENT_SUPPORT</option>
    <option>MARKETING_OUTREACH</option>
    <option>LEGAL_DOCUMENTATION</option>
    <option>PAYMENT_TASK</option>
  </select>

  <select class="form-select w-auto" [(ngModel)]="selectedStatus" (change)="applyFilters()">
    <option value="">All Status</option>
    <option>Pending</option>
    <option>In Progress</option>
    <option>Completed</option>
    <option>Partial</option>
  </select>

  <button class="btn btn-success" (click)="sendBulk()">ðŸ“§ Send All</button>
  <button class="btn btn-dark" (click)="exportCSV()">â¬‡ Export</button>
</div>

<div *ngIf="loading" class="text-center p-3">
  <div class="spinner-border text-primary"></div>
  <p class="mt-2">Loading follow-ups...</p>
</div>

<div *ngIf="!loading">

  <div class="alert"
       [class.alert-success]="followupCount > 0"
       [class.alert-secondary]="followupCount === 0">
    <strong>{{ message }}</strong>
  </div>

  <!-- âœ… Responsive Wrapper -->
  <div class="table-responsive mobile-scroll" *ngIf="filteredTasks.length > 0; else noTasks">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-primary">
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Module</th>
          <th>Due Date</th>
          <th>Status</th>
          <th>Email</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let t of filteredTasks">
          <td>{{ t.id }}</td>
          <td>{{ t.title }}</td>
          <td>
            <span class="badge bg-info">{{ t.module }}</span>
          </td>
          <td>{{ t.dueDate | date: 'mediumDate' }}</td>
          <td>
            <span class="badge"
              [ngClass]="{
                'bg-warning': t.status === 'Pending',
                'bg-primary': t.status === 'In Progress',
                'bg-success': t.status === 'Completed',
                'bg-secondary': t.status === 'Partial'
              }">
              {{ t.status }}
            </span>
          </td>
          <td>
            <span *ngIf="t.email; else noEmail">{{ t.email }}</span>
            <ng-template #noEmail>
              <span class="text-muted">Not Assigned</span>
            </ng-template>
          </td>
          <td>
            <button class="btn btn-sm btn-outline-primary"
                    (click)="sendEmail(t.id)"
                    [disabled]="!t.email">
              ðŸ“§ Send
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #noTasks>
    <div class="text-center text-muted p-4">
      No overdue tasks found.
    </div>
  </ng-template>

</div>
