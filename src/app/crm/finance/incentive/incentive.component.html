<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="text-primary mb-0">üèÜ Incentive & Payout Management</h4>
  <button class="btn btn-success" (click)="openAddModal('incentiveModal')">‚ûï Add Incentive</button>
</div>

<div class="mb-3">
  <input class="form-control" placeholder="Search by employee or deal ID..."
         [(ngModel)]="searchText">
</div>

<div *ngIf="isLoading" class="text-center my-4">
  <div class="spinner-border text-primary"></div>
  <p class="text-muted mt-2">Loading incentives...</p>
</div>

<div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

<div *ngIf="!isLoading">
  <table class="table table-hover align-middle">
    <thead class="table-primary">
      <tr>
        <th>#</th>
        <th>Employee</th>
        <th>Deal</th>
        <th>Amount</th>
        <th>Commission %</th>
        <th>Payout</th>
        <th>Status</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let it of incentives | filter: searchText; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ it.employee }}</td>
        <td>{{ it.dealId }}</td>
        <td>‚Çπ{{ it.amount | number }}</td>
        <td>{{ it.commissionPct }}%</td>
        <td>‚Çπ{{ it.computedPayout | number }}</td>

        <td>
          <span class="badge"
            [ngClass]="{
              'bg-warning text-dark': it.status === 'Pending',
              'bg-info text-dark': it.status === 'Approved',
              'bg-success': it.status === 'Paid',
                'bg-secondary text-white': it.status == 'On Hold', 
                 'bg-danger text-white': it.status == 'Cancelled'
            }">
            {{ it.status }}
          </span>
        </td>

        <td class="text-center">
          <button class="btn btn-sm btn-outline-danger" (click)="delete(it.id)">üóëÔ∏è</button>
        </td>
      </tr>

      <tr *ngIf="incentives.length === 0">
        <td colspan="8" class="text-center text-muted py-3">
          No incentive records found.
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Modal -->
<div class="modal fade" id="incentiveModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">

      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">‚ûï Add Incentive</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form>
          <div class="row g-3">

            <div class="col-md-6">
              <label class="form-label">Employee</label>
              <select class="form-select" [(ngModel)]="model.employee" name="employee">
                <option value="">Select...</option>
                <option *ngFor="let emp of employees" [value]="emp.name">
                  {{ emp.name }}
                </option>
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">Deal ID</label>
              <input class="form-control" [(ngModel)]="model.dealId" name="dealId">
            </div>

            <div class="col-md-6">
              <label class="form-label">Amount (‚Çπ)</label>
              <input type="number" class="form-control" [(ngModel)]="model.amount" name="amount">
            </div>

            <div class="col-md-6">
              <label class="form-label">Commission %</label>
              <input type="number" class="form-control" [(ngModel)]="model.commissionPct" name="commissionPct">
            </div>

          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" (click)="add()">Save</button>
      </div>
    </div>
  </div>
</div>
