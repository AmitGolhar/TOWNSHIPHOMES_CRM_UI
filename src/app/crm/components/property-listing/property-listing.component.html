<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="text-primary">üèòÔ∏è Property Listing & Management Tasks</h4>
  <button class="btn btn-success" (click)="openAddModal()">‚ûï Add Task</button>
</div>

<!-- üîÑ Loader -->
<div *ngIf="isLoading" class="text-center my-4">
  <div class="spinner-border text-primary" role="status"></div>
  <p class="text-muted mt-2">Loading property tasks...</p>
</div>

<!-- ‚ùå Error Message -->
<div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

<!-- üîç Search Bar -->
<div class="mb-3" *ngIf="!isLoading && !errorMessage">
  <input type="text" class="form-control" placeholder="Search by property name, location..." [(ngModel)]="searchText" />
</div>

<!-- üßæ Table -->
<div *ngIf="!isLoading && !errorMessage">
  <table class="table table-hover align-middle">
    <thead class="table-primary">
      <tr>
        <th>#</th>
        <th>Task Type</th>
        <th>Property Name</th>
        <th>Property Code</th>
        <th>Location</th>
        <th>Assigned To</th>
        <th>Status</th>
        <th>Due Date</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let task of propertyTasks | filter: searchText; let i = index"
        class="animate__animated animate__fadeIn">
        <td>{{ i + 1 }}</td>
        <td>{{ task.taskType }}</td>
        <td>{{ task.propertyName }}</td>
        <td>{{ task.propertyCode || '-' }}</td>
        <td>{{ task.location }}</td>
        <td>{{ employeeMap[task.assignedTo] || '-' }}</td>
        <td>
          <span class="badge" [ngClass]="{
              'bg-warning text-dark': task.status === 'Pending',
              'bg-info text-dark': task.status === 'In Progress',
              'bg-success': task.status === 'Completed'
            }">
            {{ task.status }}
          </span>
        </td>
        <td>{{ task.dueDate | date: 'mediumDate' }}</td>
        <td class="text-center">
          <button class="btn btn-sm btn-outline-primary me-1" (click)="openEditModal(task)">
            ‚úèÔ∏è
          </button>
          <button class="btn btn-sm btn-outline-danger" (click)="deleteTask(task.id)">
            üóëÔ∏è
          </button>
        </td>
      </tr>

      <!-- Empty Message -->
      <tr *ngIf="propertyTasks.length === 0">
        <td colspan="9" class="text-center text-muted py-3">
          No property tasks found.
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- üß© Modal -->
<div class="modal fade" id="propertyModal" tabindex="-1" aria-labelledby="propertyModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="propertyModalLabel">
          {{ isEditing ? '‚úèÔ∏è Edit Task' : '‚ûï Add New Task' }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Task Type</label>
              <select class="form-select" [(ngModel)]="selectedTask.taskType" name="taskType" required>
                <option value="">Select...</option>
                <option *ngFor="let type of taskTypes">{{ type }}</option>
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label fw-semibold">Property Name</label>
              <input type="text" class="form-control" [(ngModel)]="selectedTask.propertyName" name="propertyName"
                required />
            </div>

            <div class="col-md-6">
              <label class="form-label fw-semibold">Property Code</label>
              <input type="text" class="form-control" [(ngModel)]="selectedTask.propertyCode" name="propertyCode" />
            </div>

            <div class="col-md-6">
              <label class="form-label fw-semibold">Location</label>
              <input type="text" class="form-control" [(ngModel)]="selectedTask.location" name="location" required />
            </div>

            <div class="col-md-6">
              <label class="form-label fw-semibold">Assigned To</label>
              <select class="form-select" [(ngModel)]="selectedTask.assignedTo" name="assignedTo">
                <option value="">Select Employee...</option>

                <option *ngFor="let emp of employees" [value]="emp.id">
                  {{ emp.name }}
                </option>
              </select>
            </div>


            <div class="col-md-3">
              <label class="form-label fw-semibold">Status</label>
              <select class="form-select" [(ngModel)]="selectedTask.status" name="status">
                <option *ngFor="let s of statuses">{{ s }}</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label fw-semibold">Due Date</label>
              <input type="date" class="form-control" [(ngModel)]="selectedTask.dueDate" name="dueDate" required />
            </div>

            <div class="col-12">
              <label class="form-label fw-semibold">Notes</label>
              <textarea class="form-control" rows="2" [(ngModel)]="selectedTask.notes" name="notes"></textarea>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button class="btn btn-primary" (click)="saveTask()" [disabled]="isSaving">

          <span *ngIf="!isSaving">
            {{ isEditing ? 'Update' : 'Save' }}
          </span>

          <span *ngIf="isSaving">
            <span class="spinner-border spinner-border-sm me-2"></span>
            Processing...
          </span>

        </button>

      </div>
    </div>
  </div>
</div>