<div class="container mt-4">

  <h4 class="text-primary">ğŸ¢ Add 99acres WhatsApp Lead</h4>

  <!-- Success -->
  <div *ngIf="successMessage" class="alert alert-success mt-3">
    {{ successMessage }}
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="alert alert-danger mt-3">
    {{ errorMessage }}
  </div>

  <!-- Lead Input -->
  <form (ngSubmit)="submitMessage()" class="mt-3">

    <label class="form-label fw-semibold">Paste 99acres Lead Message</label>
   <textarea class="form-control"
          rows="7"
          [(ngModel)]="rawMessage"
          (ngModelChange)="onRawMessageChange()"
          name="rawMessage"
          placeholder="Paste 99acres message here..."
          required></textarea>


    <div class="row mt-3">

      <div class="col-md-6">
        <label class="form-label">Assigned To</label>
        <select class="form-select" [(ngModel)]="selectedTask.assignedTo" name="assignedTo">
          <option value="">Select...</option>
          <option *ngFor="let emp of employees" [value]="emp.id">
            {{ emp.name }}
          </option>
        </select>
      </div>

      <div class="col-md-6">
        <label class="form-label">Task Type</label>
        <select class="form-select" [(ngModel)]="selectedTask.taskType" name="taskType">
          <option *ngFor="let type of taskTypes">
            {{ type }}
          </option>
        </select>
      </div>

    </div>


<button class="btn btn-primary w-100 mt-3" (click)="submitMessage()" [disabled]="isSaving">

  <span *ngIf="!isSaving">
    ğŸ“© Save Lead
  </span>

  <span *ngIf="isSaving">
    <span class="spinner-border spinner-border-sm me-2"></span>
    {{ saveMessage }}
  </span>

</button>


  </form>

  <!-- Divider -->
  <hr class="my-4" />

  <h4 class="text-primary">ğŸ“‹ Saved 99acres Leads</h4>

  <!-- Loader -->
  <div *ngIf="isLoading" class="text-center my-3">
    <div class="spinner-border text-primary"></div>
    <p class="text-muted mt-2">Loading leads...</p>
  </div>

  <!-- Table -->
  <table *ngIf="!isLoading" class="table table-striped table-hover mt-3">
    <thead class="table-primary">
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Phone</th>
        <th>Email</th>
        <th>Budget</th>
        <th>Beds</th>
        <th>Type</th>
        <th>Purpose</th>
        <th>Project</th>
        <th>Locality</th>
        <th>Received</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let lead of leads; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ lead.name }}</td>
        <td>
          <a [href]="'tel:' + lead.phone">{{ lead.phone }}</a>
        </td>
        <td>{{ lead.email || '-' }}</td>
        <td>{{ lead.budget }}</td>
        <td>{{ lead.beds }}</td>
        <td>{{ lead.propertyType }}</td>
        <td>{{ lead.purpose }}</td>
        <td>{{ lead.projectName }}</td>
        <td>{{ lead.locality }}</td>
        <td>{{ lead.createdAt | date:'medium' }}</td>
      </tr>
    </tbody>
  </table>

</div>